<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Report Mensile Motosprint - Gennaio</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; color: #004080; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #004080; padding: 10px; text-align: center; }
    th { background-color: #004080; color: white; }
    input[type="number"] { width: 80px; padding: 5px; }
    select { padding: 5px; }
    button { margin-top: 20px; padding: 10px 20px; background-color: #004080; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; }
    button:hover { background-color: #0066cc; }
  </style>
</head>
<body>
  <h1>Report Mensile Motosprint</h1>

  <label for="mese">Seleziona mese:</label>
  <select id="mese">
    <option>Gennaio</option>
    <option>Febbraio</option>
    <option>Marzo</option>
    <option>Aprile</option>
    <option>Maggio</option>
    <option>Giugno</option>
    <option>Luglio</option>
    <option>Agosto</option>
    <option>Settembre</option>
    <option>Ottobre</option>
    <option>Novembre</option>
    <option>Dicembre</option>
  </select>

  <table>
    <tr>
      <th>Autore</th>
      <th>Articoli</th>
      <th>Visualizzazioni</th>
    </tr>
    <tr><td>Alessandro Di Moro</td><td><input type="number" id="articoli1"></td><td><input type="number" id="visualizzazioni1"></td></tr>
    <tr><td>Gianmaria Rosati</td><td><input type="number" id="articoli2"></td><td><input type="number" id="visualizzazioni2"></td></tr>
    <tr><td>Marco Pezzoni</td><td><input type="number" id="articoli3"></td><td><input type="number" id="visualizzazioni3"></td></tr>
    <tr><td>Francesco Allevato</td><td><input type="number" id="articoli4"></td><td><input type="number" id="visualizzazioni4"></td></tr>
    <tr><td>Mirco Colombi</td><td><input type="number" id="articoli5"></td><td><input type="number" id="visualizzazioni5"></td></tr>
    <tr><td>Serena Zunino</td><td><input type="number" id="articoli6"></td><td><input type="number" id="visualizzazioni6"></td></tr>
    <tr><td>Mathias Cantarini</td><td><input type="number" id="articoli7"></td><td><input type="number" id="visualizzazioni7"></td></tr>
  </table>

  <button type="button" id="salva">Salva dati</button>

  <script>
    const URL_WEB_APP = "https://script.google.com/macros/s/AKfycbw4Doj0CJ1FNhZS5W6UMKNLLUJDaUwjAADE2A3qFjyCwoTYPM2UEVt30D1TNITTFt2r/exec"; // <--- sostituisci con il tuo URL
    const mesePredefinito = "Gennaio";
    const autori = [
      "Alessandro Di Moro",
      "Gianmaria Rosati",
      "Marco Pezzoni",
      "Francesco Allevato",
      "Mirco Colombi",
      "Serena Zunino",
      "Mathias Cantarini"
    ];

    document.querySelector("#mese").value = mesePredefinito;

    // Cambio pagina mese
    document.querySelector("#mese").addEventListener("change", function() {
      const mese = this.value.toLowerCase();
      window.location.href = mese + ".html";
    });

    // Carica dati dal foglio
    async function caricaDati() {
      try {
        const res = await fetch(URL_WEB_APP);
        const data = await res.json();
        data.forEach(riga => {
          if (riga[0] === mesePredefinito) {
            const index = autori.indexOf(riga[1]);
            if (index !== -1) {
              document.querySelector(`#articoli${index+1}`).value = riga[2];
              document.querySelector(`#visualizzazioni${index+1}`).value = riga[3];
            }
          }
        });
      } catch(e) {
        console.error("Errore nel caricamento dati:", e);
      }
    }

    caricaDati();

    // Salva dati sul foglio
    document.querySelector("#salva").addEventListener("click", async () => {
      const mese = document.querySelector("#mese").value;
      for(let i=0; i<autori.length; i++) {
        const obj = {
          mese: mese,
          autore: autori[i],
          articoli: document.querySelector(`#articoli${i+1}`).value,
          visualizzazioni: document.querySelector(`#visualizzazioni${i+1}`).value
        };
        try {
          await fetch(URL_WEB_APP, {
            method: "POST",
            body: JSON.stringify(obj),
            headers: {"Content-Type":"application/json"}
          });
        } catch(e) {
          console.error("Errore nel salvataggio dati:", e);
        }
      }
      alert("Dati salvati su Google Sheets!");
    });
  </script>
</body>
</html>
